<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ultimate PLR Analyzer — Local Troubleshooter</title>
<style>
  :root{
    --grad: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    --ink:#111; --muted:#666; --soft:#f6f7fb; --card:#ffffff;
    --ok:#2e7d32; --warn:#ef6c00; --bad:#c62828; --line:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;font:15px/1.5 system-ui,Segoe UI,Roboto,Arial;background:var(--soft);color:var(--ink)}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  .hero{background:var(--grad);color:#fff;border-radius:14px;padding:22px 20px;margin-bottom:16px;box-shadow:0 10px 30px rgba(0,0,0,.12)}
  .hero h1{margin:0 0 8px;font-size:24px}
  .hero p{margin:0;opacity:.95}
  .grid{display:grid;gap:14px;grid-template-columns:1fr 1fr}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px}
  .upload{border:2px dashed var(--line);border-radius:12px;background:#fff;text-align:center;padding:20px;cursor:pointer}
  .upload:hover{background:#f0f4ff;border-color:#bcd}
  .muted{color:var(--muted)}
  .btn{display:inline-block;border:0;border-radius:20px;padding:10px 14px;background:#4f46e5;color:#fff;font-weight:600;cursor:pointer}
  .btn.alt{background:#0ea5e9}
  .btn.warn{background:#ef4444}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left;vertical-align:top}
  th{background:#f3f4f6}
  .pill{display:inline-block;padding:3px 8px;border-radius:999px;background:#eef;border:1px solid #ccd;margin:2px 6px 2px 0;font-size:12px}
  .score.ok{color:var(--ok)} .score.warn{color:var(--warn)} .score.bad{color:var(--bad)}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  textarea{width:100%;min-height:120px;border:1px solid var(--line);border-radius:8px;padding:10px}
  .small{font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <section class="hero">
    <h1>Ultimate PLR Analyzer — Local Troubleshooter</h1>
    <p>Drop your PLR files, get instant insights for Etsy. Works offline for .txt. PDF and DOCX are stubbed so you can wire your own extractor.</p>
  </section>

  <div class="grid">
    <div class="card">
      <div id="drop" class="upload">
        <strong>Drop PLR files here</strong><br>
        <span class="muted">TXT first for full in-browser analysis. PDF and DOCX show placeholders you can replace with your own extraction.</span><br><br>
        <input id="fileInput" type="file" multiple />
      </div>
      <div class="row" style="margin-top:10px">
        <button id="exportCsv" class="btn" disabled>Export CSV</button>
        <button id="clear" class="btn warn" disabled>Clear</button>
        <span id="status" class="muted"></span>
      </div>
    </div>

    <div class="card">
      <strong>Notes</strong>
      <ul class="small">
        <li>TXT files are parsed locally. No uploads leave your machine.</li>
        <li>PDF and DOCX rows include a note to plug in your extractor. You can connect pdf.js or a server endpoint when ready.</li>
        <li>Outputs include word count, reading time, top keywords, draft Etsy title, and tags.</li>
      </ul>
      <div class="muted small">Tip: keep your session focused to avoid tool context resets. This file runs standalone, so no platform limits here.</div>
    </div>
  </div>

  <div class="card" style="margin-top:14px">
    <strong>Results</strong>
    <table id="tbl">
      <thead>
        <tr>
          <th>File</th>
          <th>Stats</th>
          <th>Top Keywords</th>
          <th>Etsy Draft</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td colspan="5" class="muted">No files yet</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // Simple state
  const state = { rows: [] };

  // Helpers
  function toWords(txt){
    return (txt || "")
      .toLowerCase()
      .replace(/[^a-z0-9\s'-]/g," ")
      .split(/\s+/)
      .filter(Boolean);
  }
  function wordCount(txt){ return toWords(txt).length; }
  function readingTimeMinutes(words){ return Math.max(1, Math.round(words / 200)); }

  // Keyword frequency
  function topKeywords(txt, limit = 12){
    const stop = new Set(["the","and","for","you","your","to","a","of","in","on","or","is","it","with","as","by","be","are","this","that","an","at","from","can","will","how","into","over","up","down","out","we","our","their","they","them","but"]);
    const freq = new Map();
    for(const w of toWords(txt)){
      if (stop.has(w) || w.length < 3) continue;
      freq.set(w, (freq.get(w) || 0) + 1);
    }
    return [...freq.entries()].sort((a,b)=>b[1]-a[1]).slice(0,limit);
  }

  // Quick quality checks
  function qualitySummary(txt){
    const words = wordCount(txt);
    const minutes = readingTimeMinutes(words);
    const paragraphs = (txt.trim().match(/\n\s*\n/g) || []).length + 1;
    const hasHeadings = /(^|\n)\s*#{1,3}\s+|(^|\n)\s*(chapter|section|lesson)\s+\d+/i.test(txt);
    const bullets = (txt.match(/(^|\n)\s*[-*•]\s+/g) || []).length;

    const checks = [];
    checks.push(`Words: ${words}  •  Est. reading: ${minutes} min`);
    checks.push(`Paragraphs: ${paragraphs}  •  Bullets: ${bullets}`);
    checks.push(`Headings detected: ${hasHeadings ? "yes" : "no"}`);
    return checks.join("<br>");
  }

  // Etsy title and tags generator
  function generateEtsy(txt){
    const kws = topKeywords(txt, 13).map(k=>k[0]);
    const titleCore = kws.slice(0,4).map(w=>w[0].toUpperCase()+w.slice(1)).join(" ");
    const title = (titleCore ? titleCore : "Digital Guide") + " Printable Template, Instant Download";
    const tags = kws.slice(0,13).map(k=>k.replace(/[^a-z0-9 ]/gi,"")).filter(Boolean);
    while(tags.length < 13) tags.push("digital download");
    return { title, tags: tags.slice(0,13) };
  }

  // Render a row
  function renderRow(res){
    const tbody = document.getElementById("tbody");
    if (state.rows.length === 1) tbody.innerHTML = "";
    const tr = document.createElement("tr");

    const statsHtml = `
      <div>${res.stats}</div>
      <div class="score ${res.scoreClass}">${res.scoreText}</div>
    `;

    const kwHtml = res.keywords.length
      ? res.keywords.map(([w,c])=>`<span class="pill">${w} · ${c}</span>`).join(" ")
      : `<span class="muted">n/a</span>`;

    const etsyHtml = `
      <div><strong>Title</strong>: ${res.etsy.title}</div>
      <div><strong>Tags</strong>: ${res.etsy.tags.map(t=>`<span class="pill">${t}</span>`).join(" ")}</div>
      <details style="margin-top:6px"><summary class="muted">Preview listing description</summary>
        <div class="small" style="margin-top:6px">
          This printable digital product includes thoughtfully organized content for your niche. Perfect for Etsy shoppers who want instant access and a clean, modern layout. Files are delivered as digital downloads.
        </div>
      </details>
    `;

    tr.innerHTML = `
      <td><strong>${res.name}</strong><br><span class="small muted">${res.type}</span></td>
      <td>${statsHtml}</td>
      <td>${kwHtml}</td>
      <td>${etsyHtml}</td>
      <td class="small">${res.note}</td>
    `;
    tbody.appendChild(tr);
  }

  // Score simple quality based on word count
  function scoreForWords(w){
    if (w >= 6000) return { cls:"ok", txt:"Good length for a premium PLR pack" };
    if (w >= 2500) return { cls:"warn", txt:"Decent length. Consider adding worksheets or bonus pages" };
    return { cls:"bad", txt:"Short. Consider expanding chapters or bundling" };
  }

  // Analyze TXT
  async function analyzeTxt(file){
    const text = await file.text();
    const words = wordCount(text);
    const q = scoreForWords(words);

    const res = {
      name: file.name,
      type: "text/plain",
      stats: qualitySummary(text),
      keywords: topKeywords(text, 12),
      etsy: generateEtsy(text),
      scoreClass: q.cls,
      scoreText: q.txt,
      note: "Parsed locally. Ready for listing enrichment"
    };
    state.rows.push(res);
    renderRow(res);
  }

  // Stub for PDF and DOCX so you can wire your extractor
  async function analyzePdf(file){
    const res = {
      name: file.name,
      type: "application/pdf",
      stats: "PDF parsing not enabled in this offline build",
      keywords: [],
      etsy: generateEtsy(file.name.replace(/\.pdf$/i,"")),
      scoreClass: "warn",
      scoreText: "Needs text extraction before accurate analysis",
      note: "Plug in pdf.js or send to your server to extract text, then call the same analyzers"
    };
    state.rows.push(res); renderRow(res);
  }
  async function analyzeDocx(file){
    const res = {
      name: file.name,
      type: "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
      stats: "DOCX parsing not enabled in this offline build",
      keywords: [],
      etsy: generateEtsy(file.name.replace(/\.docx$/i,"")),
      scoreClass: "warn",
      scoreText: "Needs text extraction before accurate analysis",
      note: "Use a small server with mammoth or docx parser, return plain text, then reuse the analyzers"
    };
    state.rows.push(res); renderRow(res);
  }

  // Drag and drop + input
  const drop = document.getElementById("drop");
  const fileInput = document.getElementById("fileInput");
  const status = document.getElementById("status");
  const exportBtn = document.getElementById("exportCsv");
  const clearBtn = document.getElementById("clear");

  function enableControls(){
    exportBtn.disabled = state.rows.length === 0;
    clearBtn.disabled = state.rows.length === 0;
  }

  drop.addEventListener("dragover", e => { e.preventDefault(); drop.style.background = "#eef3ff"; });
  drop.addEventListener("dragleave", e => { drop.style.background = "#fff"; });
  drop.addEventListener("drop", async e => {
    e.preventDefault(); drop.style.background = "#fff";
    await handleFiles(e.dataTransfer.files);
  });
  fileInput.addEventListener("change", async e => {
    await handleFiles(e.target.files);
  });

  async function handleFiles(fileList){
    const files = Array.from(fileList || []);
    if (!files.length) return;
    status.textContent = `Queued ${files.length} file(s)`;
    for(const f of files){
      const type = f.type || "";
      if (/\.(txt|md)$/i.test(f.name) || type === "text/plain"){ await analyzeTxt(f); continue; }
      if (/\.pdf$/i.test(f.name) || type === "application/pdf"){ await analyzePdf(f); continue; }
      if (/\.docx$/i.test(f.name)){ await analyzeDocx(f); continue; }
      // Fallback for other types
      state.rows.push({
        name: f.name, type: type || "unknown",
        stats: "Unsupported type in this offline build",
        keywords: [], etsy: { title:"", tags:[] },
        scoreClass: "bad", scoreText: "No analysis",
        note: "Convert to TXT for instant local parsing"
      });
      renderRow(state.rows[state.rows.length-1]);
    }
    enableControls();
    status.textContent = `Analyzed ${state.rows.length} file(s)`;
  }

  // Export CSV
  exportBtn.addEventListener("click", () => {
    const rows = [
      ["file","type","words","reading_minutes","keywords","etsy_title","etsy_tags","quality_note","notes"]
    ];
    for(const r of state.rows){
      const words = (r.stats.match(/Words:\s*(\d+)/) || [,"0"])[1];
      const mins = (r.stats.match(/Est\. reading:\s*(\d+)/) || [,"0"])[1];
      const kws = r.keywords.map(k=>k[0]).join("|");
      const tags = r.etsy.tags.join("|");
      rows.push([r.name, r.type, words, mins, kws, r.etsy.title, tags, r.scoreText, r.note]);
    }
    const csv = rows.map(r=>r.map(x => `"${String(x).replace(/"/g,'""')}"`).join(",")).join("\n");
    const blob = new Blob([csv], {type:"text/csv"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "plr_analysis.csv";
    a.click();
  });

  // Clear
  clearBtn.addEventListener("click", () => {
    state.rows = [];
    document.getElementById("tbody").innerHTML = '<tr><td colspan="5" class="muted">No files yet</td></tr>';
    enableControls();
    status.textContent = "";
    fileInput.value = "";
  });

  enableControls();
</script>
</body>
</html>
